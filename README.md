# kafka_hw_02

## Тема работы
"Реализация сервиса обмена сообщениями с возможностью фильтрации и агрегирования сообщений."

## Требования
- ОС Linux (использовалась Ubuntu 22.04.5 LTS)
- Docker и Docker Compose (использовались версии 28.4.0 и 2.39.4)
- Make
- curl для тестирования (либо клиент наподобие Postman, Insomnia и тп)

## Установка
```bash
git clone git@github.com:A-Rogachev/kafka_hw_02.git
cd kafka_hw_02
```

## Команды для взаимодействия с приложением
| Команда | Действие | Комментарий|
|----------|----------|----------|
| <b>make start</b> | Запуск приложения | запускает Kafka кластер, Faust, ksqlDB и UI |
| <b>make stop</b>|Остановка приложения|удаление контейнеров и томов данных |
| make check|Проверка работы контейнеров| псевдоним для <b>docker compose ps -a</b> |
| make logs|Просмотр логов всех сервисов| псевдоним для <b>docker compose logs -f</b> |
| <b>make faust_log</b>|Просмотр логов Faust|логи приложения потоковой обработки |
| <b>make ksql</b>|Консоль ksqlDB | интерактивный доступ к ksqlDB CLI |


### Компоненты:
- **Kafka Cluster**: 3 брокера с Apache ZooKeeper в качестве сервиса-координатора
- **Faust Streaming App**: Приложение для потоковой обработки данных
- **ksqlDB**: Служба для аналитики сообщений
- **Kafka-UI**: Веб интерфейс для мониторинга Kafka

### Топики Kafka:
- `messages` - исходные сообщения от пользователей
- `filtered_messages` - сообщения с примененной цензурой на слова
- `blocked_users` - информация о заблокированных пользователях
- `banned_words` - запрещенные в сообщениях слова

### Возможности и описание приложения:
1. **Цензура сообщений**: буквы в запрещенных словах маскируются символом "<b>*</b>"
2. **Блокировка пользователей**: пользователь не получает сообщения от заблокированных им пользователей
3. **HTTP API**: возможность отправки сообщений, добавления/удаления запрещенных слов, блокировки ползователей (примеры взаимодействия с API описано в <b>api_examples.md</b>)
4. **Аналитика**: получение статистики по сообщениям пользователей при помощи ksqlDB

## Работа с ksqlDB

После старта контейнеров и завершения инициализации ksqlDB будут созданы:
- Стрим `messages_stream` из топика `messages`
- Таблица `user_statistics` с агрегированной статистикой по пользователям
- файл <b>ksqldb-queries.sql</b> содержит примеры запросов для получения статистики по собщениям

## Генерация тестовых данных
Приложение автоматически генерирует случайные сообщения каждые 2 секунды с помощью библиотеки Faker. 
Сообщения генерируются между пользователями с ID от 1 до 9 (включительно).


## Примечания
- Переменные окружения для настройки представлены в файле env.example
- Для продюсера и потребителей использован образ на основе <b>python:3.11-slim</b>
- Для кластера kafka использован образ <b>confluentinc/cp-kafka:7.0.1</b>
- Для Faust таблиц в качестве хранилища используется https://pypi.org/project/rocksdict/
- Для приложения Faust использован образ на основе <b>python:3.11-slim</b>
- Выход из консоли ksqlDB -> `ctrl+d`
